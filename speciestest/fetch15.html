<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Species Database Query</title>
    <style>
        /* Style for slider and input fields */
        .range-field {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .range-field input[type=number], .search-input {
            margin: 0 5px;
            width: 80px;
        }
        input[type=range] {
            -webkit-appearance: none;
            width: calc(100% - 10px);
            margin: 0 5px;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 5px;
            background: #ddd;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            background: #007bff;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }
    </style>
</head>
<body>
    <h1>Species Database Query</h1>
    <div>
        <!-- Range fields for Altitudinal -->
        <div class="range-field">
            <label for="altitudinal-inferior">Altitudinal Inferior:</label>
            <input type="number" id="altitudinal-inferior" name="ALTITUDINAL_INFERIOR" value="0" min="0" max="10000" step="100">
            <input type="range" id="altitudinal-inferior-slider" min="0" max="10000" value="0" step="100">
        </div>
        <div class="range-field">
            <label for="altitudinal-superior">Altitudinal Superior:</label>
            <input type="number" id="altitudinal-superior" name="ALTITUDINAL_SUPERIOR" value="900" min="0" max="10000" step="100">
            <input type="range" id="altitudinal-superior-slider" min="0" max="10000" value="900" step="100">
        </div>
        <!-- Search inputs with autocomplete for various fields -->
        <input type="text" class="search-input" id="id-input" name="ID" placeholder="ID">
        <input type="text" class="search-input" id="specific-epithet-input" name="SPECIFIC_EPITHET" placeholder="Specific Epithet">
        <input type="text" class="search-input" id="genus-input" name="GENUS" placeholder="Genus">
        <input type="text" class="search-input" id="type-input" name="TYPE" placeholder="Type">
        <input type="text" class="search-input" id="origin-input" name="ORIGIN" placeholder="Origin">
        <!-- Other search inputs -->
        <input type="text" class="search-input" id="distribution-input" name="DISTRIBUTION" placeholder="Distribution">
        <input type="text" class="search-input" id="distribution-north-input" name="DISTRIBUTION_NORTH" placeholder="Distribution North">
        <input type="text" class="search-input" id="distribution-south-input" name="DISTRIBUTION_SOUTH" placeholder="Distribution South">
        <!-- Action buttons -->
        <button id="fetchDataBtn">Fetch Data</button>
        <button id="clearDataBtn">Clear Data</button>
        <!-- Messages and Data -->
        <div id="messages"></div>
        <pre id="data"></pre>
    </div>

<script>
    // Synchronize slider and input for Altitudinal Inferior
    const altInferiorInput = document.getElementById('altitudinal-inferior');
    const altInferiorSlider = document.getElementById('altitudinal-inferior-slider');
    altInferiorInput.addEventListener('input', function() {
        altInferiorSlider.value = this.value;
    });
    altInferiorSlider.addEventListener('input', function() {
        altInferiorInput.value = this.value;
    });

    // Synchronize slider and input for Altitudinal Superior
    const altSuperiorInput = document.getElementById('altitudinal-superior');
    const altSuperiorSlider = document.getElementById('altitudinal-superior-slider');
    altSuperiorInput.addEventListener('input', function() {
    altSuperiorSlider.value = this.value;
});
altSuperiorSlider.addEventListener('input', function() {
    altSuperiorInput.value = this.value;
});

document.getElementById('fetchDataBtn').addEventListener('click', fetchData);
document.getElementById('clearDataBtn').addEventListener('click', clearData);

// Function to fetch data based on the search parameters
function fetchData() {
    const searchParams = new URLSearchParams();
    
    // Add values from all search inputs to search parameters
    document.querySelectorAll('.search-input').forEach(input => {
        if (input.value) {
            searchParams.append(input.name, input.value);
        }
    });

    // Display a message before sending the request
    displayMessage("Fetch button clicked, sending request...");

    // Fetch data from the server
    fetch(`http://localhost:3000/query?${searchParams.toString()}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok: ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            displayMessage("Data received successfully");
            document.getElementById('data').textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
            console.error('Fetch error:', error);
            displayMessage('Fetch error: ' + error.message, true);
        });
}

// Function to display messages to the user
function displayMessage(message, isError = false) {
    const messageElement = document.getElementById('messages');
    messageElement.textContent = message;
    messageElement.style.color = isError ? 'red' : 'green';
}

// Function to clear data from the display and reset form inputs
function clearData() {
    document.getElementById('data').textContent = '';
    document.getElementById('messages').textContent = '';
    document.querySelectorAll('.search-input').forEach(input => {
        input.value = '';
    });
    // Reset sliders to their default values
    altInferiorSlider.value = altInferiorSlider.getAttribute('min');
    altSuperiorSlider.value = altSuperiorSlider.getAttribute('min');
}

</script>
</body>
</html>
