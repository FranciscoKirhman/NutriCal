<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Species Database Query with Map and Autocomplete</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; }
        .range-field { display: flex; align-items: center; margin-bottom: 20px; }
        .range-field label { margin-right: 10px; }
        input, select { margin-right: 10px; }
        #map { width: 100%; height: 400px; margin-top: 20px; }
        .autocomplete-items { position: absolute; border: 1px solid #d4d4d4; border-bottom: none; border-top: none; z-index: 99; top: 100%; left: 0; right: 0; }
        .autocomplete-items div { padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; }
        .autocomplete-items div:hover { background-color: #e9e9e9; }
        .autocomplete-active { background-color: DodgerBlue !important; color: #ffffff; }
    </style>
</head>
<body>
    <h1>Species Database Query with Map and Autocomplete</h1>
    <div class="range-field">
        <label for="altitudinal-inferior">Altitudinal Inferior:</label>
        <input type="number" id="altitudinal-inferior" name="altitudinal_inferior" value="0">
        <input type="range" id="altitudinal-inferior-slider" min="0" max="5000" value="0" step="10">
    </div>
    <div class="range-field">
        <label for="altitudinal-superior">Altitudinal Superior:</label>
        <input type="number" id="altitudinal-superior" name="altitudinal_superior" value="5000">
        <input type="range" id="altitudinal-superior-slider" min="0" max="5000" value="5000" step="10">
    </div>
    
    <label for="type-select">Type:</label>
    <select id="type-select" name="type">
        <option value="" selected>Select Type</option>
        <!-- Options will be populated by JavaScript -->
    </select>
    
    <button id="fetchDataBtn">Fetch Data</button>
    <button id="clearDataBtn">Clear Data</button>

    <div id="messages"></div>
    <pre id="data"></pre>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var map = L.map('map').setView([-33.4378, -70.6504], 4);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            function syncSliderWithInput(sliderId, inputId) {
                var slider = document.getElementById(sliderId);
                var input = document.getElementById(inputId);
                slider.oninput = function() {
                    input.value = this.value;
                };
                input.oninput = function() {
                    slider.value = this.value;
                };
            }

            syncSliderWithInput('altitudinal-inferior-slider', 'altitudinal-inferior');
            syncSliderWithInput('altitudinal-superior-slider', 'altitudinal-superior');

            function populateTypeDropdown(selectId, typeOptions) {
                const select = document.getElementById(selectId);
                for (const [category, values] of Object.entries(typeOptions)) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = category;
                    values.forEach(value => {
                        const option = document.createElement('option');
                        option.value = value;
                        option.textContent = value;
                        optgroup.appendChild(option);
                    });
                    select.appendChild(optgroup);
                }
            }

            const typeOptions = {
                "Arbustivas": ["Arbustivas", "Arbusto o árbol pequeño", "Arbusto perenne", "Arbusto o subarbusto", "Arbusto parásito", "Arbusto suculento", "Arbusto trepador", "Arbusto"],
                "Hierba": ["Hierba", "Hierba anual", "Hierba bienal", "Hierba anual o bienal", "Hierba anual, bienal o perenne", "Hierba bienal o perenne", "Hierba anual o perenne", "Hierba acuática perenne", "Hierba acuática anual", "Hierba acuática anual o bienal", "Hierba epífita o saxícola perenne", "Hierba epífita o terrestre perenne", "Hierba epífita perenne", "Hierba anual o subarbusto", "Hierba anual, hierba perenne o subarbusto", "Hierba bienal o subarbusto", "Hierba perenne o subarbusto", "Hierba parásita anual", "Hierba parásita perenne", "Hierba saxícola perenne", "Hierba suculenta anual", "Hierba suculenta perenne", "Hierba terrestre o saxícola perenne", "Hierba trepadora anual", "Hierba trepadora anual o bienal", "Hierba trepadora perenne"],
                "Subarbusto": ["Subarbusto", "Subarbusto perenne", "Subarbustiva", "Subarbusto epífito o terrestre", "Subarbusto epífito", "Subarbusto parásito", "Subarbusto suculento", "Subarbusto trepador"],
                "Árbol": ["Árbol", "Árbol suculento"]
            };

            populateTypeDropdown('type-select', typeOptions);
            document.getElementById('fetchDataBtn').addEventListener('click', function() {
                // Construct the query URL based on form inputs
                const baseUrl = 'https://speciesdb.ddns.net/query'; // Example API endpoint
                const searchParams = new URLSearchParams();
            
                // Assuming your form inputs have IDs or names that correspond to query parameters
                const altInferior = document.getElementById('altitudinal-inferior').value;
                const altSuperior = document.getElementById('altitudinal-superior').value;
                const type = document.getElementById('type-select').value;
                
                // Add parameters only if they have a value
                if (altInferior) searchParams.append('altitudinal_inferior', altInferior);
                if (altSuperior) searchParams.append('altitudinal_superior', altSuperior);
                if (type) searchParams.append('type', type);
                
                // Additional parameters can be added here based on other form inputs
            
                // Fetch data from the constructed URL
                fetch(`${baseUrl}?${searchParams.toString()}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Process and display the fetched data
                        // For simplicity, we're just displaying the JSON in a <pre> element
                        document.getElementById('data').textContent = JSON.stringify(data, null, 2);
                    })
                    .catch(error => {
                        console.error('There has been a problem with your fetch operation:', error);
                        document.getElementById('messages').textContent = 'Error fetching data: ' + error.message;
                    });
            });

            document.getElementById('clearDataBtn').addEventListener('click', function() {
                document.getElementById('data').textContent = '';
                document.getElementById('messages').textContent = '';
                // Reset inputs and selects to their default values
                document.querySelectorAll('input[type="number"], select').forEach(input => input.value = input.defaultValue);
            });
        });
    </script>
</body>
</html>
