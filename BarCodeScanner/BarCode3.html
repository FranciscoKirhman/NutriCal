<!DOCTYPE html>
<html>
<head>
    <title>QR Code Scanner</title>
    <style>
        #cameraStream {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

<video id="cameraStream" playsinline style="display:none;"></video>
<button id="startButton">Start Camera</button>
<div id="qrResult">QR Code result will appear here</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<script>
    const video = document.getElementById('cameraStream');
    const canvasElement = document.createElement('canvas');
    const canvas = canvasElement.getContext('2d');
    const qrResult = document.getElementById('qrResult');
    const startButton = document.getElementById('startButton');
    let scanning = false;

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }).then(function(stream) {
        scanning = true;
        video.srcObject = stream;
        video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
        video.play();
        tick();
        scan();
    });

    function tick() {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvasElement.hidden = false;
            canvasElement.height = video.videoHeight;
            canvasElement.width = video.videoWidth;
            canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);

            scanning && requestAnimationFrame(tick);
        }
    }

    function scan() {
        try {
            const imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height, {
                inversionAttempts: "dontInvert",
            });
            if (code) {
                displayResult(code.data);
                scanning = false;
                video.srcObject.getTracks().forEach(track => track.stop());
            } else {
                requestAnimationFrame(scan);
            }
        } catch (e) {
            requestAnimationFrame(scan);
        }
    }

    function displayResult(data) {
        qrResult.textContent = `QR Code result: ${data}`;
    }

    startButton.onclick = function() {
        if (!scanning) {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }).then(function(stream) {
                scanning = true;
                video.srcObject = stream;
                video.play();
                tick();
                scan();
            });
        }
    };
</script>

</body>
</html>
