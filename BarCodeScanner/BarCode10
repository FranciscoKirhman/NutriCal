<!DOCTYPE html>
<html>
<head>
    <title>QR Code Scanner</title>
    <style>
        #cameraStream {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

<video id="cameraStream" playsinline></video>
<button id="startButton">Start Camera</button>
<div id="qrResult">QR Code result will appear here</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<script>
    const video = document.getElementById('cameraStream');
    const qrResult = document.getElementById('qrResult');
    const startButton = document.getElementById('startButton');
    let scanning = false;

    startButton.onclick = function() {
        if (!scanning) {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(function(stream) {
                scanning = true;
                video.srcObject = stream;
                video.play();
                scanQRCode();
            }).catch(function(error) {
                console.log("Error accessing camera: ", error);
            });
        }
    };

    function scanQRCode() {
        const canvasElement = document.createElement('canvas');
        const canvas = canvasElement.getContext('2d');

        function drawCanvas() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvasElement.height = video.videoHeight;
                canvasElement.width = video.videoWidth;
                canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);

                const imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height, {
                    inversionAttempts: "dontInvert",
                });

                if (code) {
                    qrResult.textContent = `QR Code result: ${code.data}`;
                    scanning = false;
                    video.srcObject.getTracks().forEach(track => track.stop());
                    return;
                }
            }
            requestAnimationFrame(drawCanvas);
        }
        drawCanvas();
    }
</script>

</body>
</html>
